# Link Zipper

Сервис для скачивания публичных файлов по URL и упаковки их в ZIP-архив.

## Возможности

- Создание задачи на упаковку до 3 файлов (расширения файлов для скачивания настраиваются в конфиге)
- Автоматическая сборка архива после добавления третьего файла
- Преждевременная сборка архива
- Ограничение на 3 одновременные задачи
- Информирование об ошибках при недоступности ресурсов
  
## Паттерны и практики

* In-Memory TaskManager с `sync.Mutex`\
    Структура TaskManager хранит задачи и использует мьютекс для потокобезопасной работы с памятью
* Асинхронная обработка задач через goroutine\
    После добавления всех ссылок задача передаётся на обработку в отдельную горутину `go m.process(task)`
* REST API на базе `chi`\
    В `main.go` создаётся роутер chi и настраиваются HTTP‑маршруты для всех операций сервиса
* Структурированное логирование с `logrus`\
    Файл `logger.go` инициализирует `logrus`‑логгер и задаёт форматирование/уровень логов
* Конфигурация через `viper`\
    Модуль `config.go` считывает YAML‑конфиг с помощью `viper` и маппит его в структуру `Config`

## Работа с приложением

### Запуск

```
Link Zipper
```

Сервер стартует на порту, указанном в `config.yaml` (по умолчанию `8080`).

### HTTP-эндпоинты

1. **Создание задачи**

   ```
   POST /tasks
   ```

2. **Добавление ссылки**

   ```
   POST /tasks/links
   {"task_id": "task-...", "url": "https://host/file.pdf"}
   ```

3. **Получение статуса**

   ```
   GET /tasks/status/{task_id}
   => {"status": "pending"|"complete", "errors": {"url":"msg"}, "archive_url": "/download/{task_id}"}
   ```

4. **Скачивание архива**

   ```
   GET /download/{task_id}
   ```

5. **Получение списка задач**

    ```
    GET /tasks/list
    ```

6. **Преждевременная упаковка архива**

    ```
    POST /tasks/zip`
    {"task_id": "task-..."}
    ```

7. **Удаление задачи**

    ```
    DELETE /tasks/delete/{task_id}
    ```

Скачивание будет доступно при достижении лимита или при использовании преждевременной упаковки архива

## Конфигурация

Файл `config.yaml`:

```yaml
server:
  port: 8080
limits:
  maxTasks: 3
  maxFilesPerTask: 3
  allowedExtensions:
    - ".pdf"
    - ".jpeg"

logging:
  level: info
  file: server.log
```
